# spring-cloud-alibaba

## 项目模块
### shop-common
>存放pojo，jar，初始化sql

### shop-order
>订单服务

### shop-product
>商品服务

### shop-user
>用户服务

### api-gateway
>网关服务



## 技术选型
### nacos
> Nacos 致力于帮助您发现、配置和管理微服务。Nacos 提供了一组简单易用的特性集，帮助您快速
  实现动态服务发现、服务配置、服务元数据及流量管理。


### Ribbon
> Ribbon是Spring Cloud的一个组件， 它可以让我们使用一个注解就能轻松的搞定负载均衡
  第1


### Feign
> Feign是Spring Cloud提供的一个声明式的伪Http客户端， 它使得调用远程服务就像调用本地服务
  一样简单， 只需要创建一个接口并添加一个注解即可。Nacos很好的兼容了Feign， Feign默认集成了 Ribbon， 所以在Nacos下使用Fegin默认就实现了负
  载均衡的效果。

### Sentinel
> Sentinel (分布式系统的流量防卫兵) 是阿里开源的一套用于服务容错的综合性解决方案。它以流量
  为切入点, 从流量控制、熔断降级、系统负载保护等多个维度来保护服务的稳定性。

> 启动脚本：java -Dserver.port=8080 -Dcsp.sentinel.dashboard.server=localhost:8080 -Dproject.name=sentinel-dashboard -jar sentinel-dashboard-1.7.0.jar

> 常见的容错思路有隔离、超时、限流、熔断、降级

> Sentinel采用延迟加载，只有在主动发起一次请求后，才会被拦截并发送给服务端。如果想关闭这个延迟，就在上面的yml里把eager的注释放掉。

> 流控规则

>> 流控方式

        1. 直接（默认）：接口达到限流条件时，开启限流
       
        2. 关联：当关联得资源达到限流得条件时，开启限流【适合做应用让步】，比如查询接口为更新接口做出让步
       
        3. 链路：链路流控模式指的是，当从某个接口过来的资源达到限流条件时，开启限流。它的功能有点类似于针对
                来源配置项，区别在于：针对来源是针对上级微服务，而链路流控是针对上级接口，也就是说它的粒度
                更细。
   
>> 配置流控效果
        
        1. 快速失败（默认）: 直接失败，抛出异常，不做任何额外的处理，是最简单的效果
       
        2. Warm Up：它从开始阈值到最大QPS阈值会有一个缓冲阶段，一开始的阈值是最大QPS阈值的
                    1/3，然后慢慢增长，直到最大阈值，适用于将突然增大的流量转换为缓步增长的场景。
       
        3. 排队等待：让请求以均匀的速度通过，单机阈值为每秒通过数量，其余的排队等待； 它还会让设
                    置一个超时时间，当请求超过超时间时间还未处理，则会被丢弃。

> 降级规则
        
        1. 平均响应时间 ：当资源的平均响应时间超过阈值（以 ms 为单位）之后，资源进入准降级状态。
           如果接下来 1s 内持续进入 5 个请求，它们的 RT都持续超过这个阈值，那么在接下的时间窗口
           （以 s 为单位）之内，就会对这个方法进行服务降级。
           注意 Sentinel 默认统计的 RT 上限是 4900 ms，超出此阈值的都会算作 4900 ms，若需要
           变更此上限可以通过启动配置项 -Dcsp.sentinel.statistic.max.rt=xxx 来配置。
        
        2. 异常比例：当资源的每秒异常总数占通过量的比值超过阈值之后，资源进入降级状态，即在接下的
           时间窗口（以 s 为单位）之内，对这个方法的调用都会自动地返回。异常比率的阈值范围是 [0.0,
           1.0]。
        
        3. 异常数 ：当资源近 1 分钟的异常数目超过阈值之后会进行服务降级。注意由于统计时间窗口是分
           钟级别的，若时间窗口小于 60s，则结束熔断状态后仍可能再进入熔断状态。

> 热点规则
>> 热点参数流控规则是一种更细粒度的流控规则, 它允许将规则具体到参数上。参数例外项允许对一个参数的具体值进行流控编辑刚才定义的规则,增加参数例外项

> 授权规则
>> 很多时候，我们需要根据调用来源来判断该次请求是否允许放行，这时候可以使用 Sentinel 的来源
   访问控制的功能。来源访问控制根据资源的请求来源（origin）限制资源是否通过：
   若配置白名单，则只有请求来源位于白名单内时才可通过；
   若配置黑名单，则请求来源位于黑名单时不通过，其余的请求通过。

> 系统规则
>> 系统保护规则是从应用级别的入口流量进行控制，从单台机器的总体 Load、RT、入口 QPS 、CPU
   使用率和线程数五个维度监控应用数据，让系统尽可能跑在最大吞吐量的同时保证系统整体的稳定性。
   系统保护规则是应用整体维度的，而不是资源维度的，并且仅对入口流量 (进入应用的流量) 生效。


### Gateway
> Spring Cloud Gateway是Spring公司基于Spring 5.0，Spring Boot 2.0 和 Project Reactor 等技术
  开发的网关，它旨在为微服务架构提供一种简单有效的统一的 API 路由管理方式。它的目标是替代
  Netflix Zuul，其不仅提供统一的路由方式，并且基于 Filter 链的方式提供了网关基本的功能，例如：安
  全，监控和限流。

### Sleuth
> SpringCloud Sleuth主要功能就是在分布式系统中提供追踪解决方案。

### ZipKin
> Zipkin 是 Twitter 的一个开源项目，它基于Google Dapper实现，它致力于收集服务的定时数据，
  以解决微服务架构中的延迟问题，包括数据的收集、存储、查找和展现。

>>启动脚本（mysql,elasticsearch）
>>>java -jar zipkin-server-2.12.9-exec.jar --STORAGE_TYPE=mysql --MYSQL_HOST=127.0.0.1 --MYSQL_TCP_PORT=3306 --MYSQL_DB=zipkin --MYSQL_USER=root --MYSQL_PASS=root
>>>java -jar zipkin-server-2.12.9-exec.jar --STORAGE_TYPE=elasticsearch --ESHOST=localhost:9200

### RocketMQ
>RocketMQ是阿里巴巴开源的分布式消息中间件，现在是Apache的一个顶级项目。在阿里内部使用非常广泛，已经经过了"双11"这种万亿级的消息流转。

### SMS短信服务
> 短信服务（Short Message Service）是阿里云为用户提供的一种通信服务的能力。

